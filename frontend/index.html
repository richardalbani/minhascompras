
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Compras</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; padding: 2rem; }
        h1 { text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: center; }
        th { background-color: #e0e0e0; }
        input[type="text"], input[type="number"] { width: 100%; box-sizing: border-box; }
        button { margin: 0.5rem; padding: 0.5rem 1rem; border: none; border-radius: 6px; background-color: #4f46e5; color: white; cursor: pointer; }
        button:hover { background-color: #4338ca; }
    </style>
</head>
<body>
    <h1>Minha Lista de Compras</h1>
    <div>Total: R$ <span id="total">0.00</span></div>
    <table id="shoppingTable">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Quantidade</th>
                <th>Valor</th>
                <th>Subtotal</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <button onclick="addItem()">Adicionar</button>
    <button onclick="saveList()">Salvar</button>

    <script>
        const BASE_URL = "https://shopping-backend.onrender.com/api";

        function addItem() {
            const tbody = document.querySelector("#shoppingTable tbody");
            const row = document.createElement("tr");
            row.innerHTML = `
                <td><input type="text" class="name"></td>
                <td><input type="number" class="qty" value="1" onchange="updateSubtotal(this)"></td>
                <td><input type="number" class="price" step="0.01" value="0" onchange="updateSubtotal(this)"></td>
                <td class="subtotal">0.00</td>
                <td><button onclick="removeItem(this)">Excluir</button></td>`;
            tbody.appendChild(row);
        }

        function updateSubtotal(el) {
            const row = el.closest("tr");
            const qty = parseFloat(row.querySelector(".qty").value) || 0;
            const price = parseFloat(row.querySelector(".price").value) || 0;
            const subtotal = qty * price;
            row.querySelector(".subtotal").innerText = subtotal.toFixed(2);
            updateTotal();
        }

        function removeItem(button) {
            button.closest("tr").remove();
            updateTotal();
        }

        function updateTotal() {
            let total = 0;
            document.querySelectorAll(".subtotal").forEach(cell => {
                total += parseFloat(cell.innerText) || 0;
            });
            document.getElementById("total").innerText = total.toFixed(2);
        }

        function saveList() {
            const items = [];
            document.querySelectorAll("#shoppingTable tbody tr").forEach(row => {
                const name = row.querySelector(".name").value;
                const qty = parseInt(row.querySelector(".qty").value);
                const price = parseFloat(row.querySelector(".price").value);
                items.push({ name, qty, price });
            });

            fetch(`${BASE_URL}/save`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ items })
            })
            .then(res => res.json())
            .then(data => alert("Lista salva com sucesso!"))
            .catch(err => alert("Erro ao salvar a lista"));
        }
    </script>
</body>
</html>
